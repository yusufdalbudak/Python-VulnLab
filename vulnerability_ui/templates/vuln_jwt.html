{% extends 'base.html' %}

{% block content %}
<h1>02. JWT Pitfalls</h1>
<p class="mb-4">Demonstrating sensitive data exposure in tokens and the 'none' algorithm vulnerability.</p>

<div class="grid">
    <!-- Generate Token -->
    <div class="card">
        <h3>1. Generate Vulnerable Token</h3>
        <p>Create a token for a standard user. Notice what's inside.</p>

        <form action="{{ url_for('vuln_jwt') }}" method="POST">
            <input type="hidden" name="action" value="generate">
            <button type="submit" class="btn">Generate Token</button>
        </form>

        {% if gen_token %}
        <div class="alert alert-success" style="margin-top: 1rem; word-break: break-all;">
            <strong>Token:</strong><br>
            {{ gen_token }}
        </div>
        <div class="alert" style="background: #334155;">
            <small>Copy this token and paste it into a JWT debugger (or below). You'll see the credit card info!</small>
        </div>
        {% endif %}
    </div>

    <!-- Verify Token -->
    <div class="card">
        <h3>2. Verify Token (Insecure)</h3>
        <p>This verification endpoint allows the <code>none</code> algorithm.</p>
        <p>Try modifying the token header to <code>{"alg": "none"}</code> and removing the signature.</p>

        {% if verify_result %}
        {% if verify_result.status == 'success' %}
        <div class="alert alert-success">
            <strong>Decoded Payload:</strong>
            <pre>{{ verify_result.payload | tojson(indent=2) }}</pre>
        </div>
        {% else %}
        <div class="alert alert-error">
            <strong>Error:</strong> {{ verify_result.msg }}
        </div>
        {% endif %}
        {% endif %}

        <form action="{{ url_for('vuln_jwt') }}" method="POST">
            <input type="hidden" name="action" value="verify">
            <div class="form-group">
                <label for="token">JWT Token</label>
                <textarea id="token" name="token" rows="4" placeholder="Paste JWT here..."></textarea>
            </div>
            <button type="submit" class="btn">Verify Token</button>
        </form>
    </div>
</div>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-danger">Back to Dashboard</a>
</div>
{% endblock %}