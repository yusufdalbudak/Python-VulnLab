{% extends 'base.html' %}

{% block content %}
<h1>03. Injection Attacks</h1>
<p class="mb-4">Demonstrating SQL Injection and OS Command Injection vulnerabilities.</p>

<div class="grid">
    <!-- SQL Injection -->
    <div class="card">
        <h3>1. SQL Injection</h3>
        <p>Retrieve hidden data by manipulating the query.</p>
        <p>Try: <code>' OR '1'='1</code></p>

        {% if sql_result %}
        <div class="alert {% if sql_result.error %}alert-error{% else %}alert-success{% endif %}">
            <strong>Executed Query:</strong><br>
            <code>{{ sql_result.query }}</code>
            {% if sql_result.data %}
            <br><br><strong>Results:</strong>
            <pre>{{ sql_result.data | tojson(indent=2) }}</pre>
            {% endif %}
            {% if sql_result.error %}
            <br><br><strong>Error:</strong> {{ sql_result.error }}
            {% endif %}
        </div>
        {% endif %}

        <form action="{{ url_for('vuln_injection') }}" method="POST">
            <input type="hidden" name="action" value="sql">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" placeholder="Enter username">
            </div>
            <button type="submit" class="btn">Search User</button>
        </form>
    </div>

    <!-- Command Injection -->
    <div class="card">
        <h3>2. Command Injection</h3>
        <p>Execute arbitrary system commands.</p>
        <p>Try: <code>127.0.0.1; ls -la</code></p>

        {% if cmd_result %}
        <div class="alert {% if cmd_result.error %}alert-error{% else %}alert-success{% endif %}">
            <strong>Executed Command:</strong><br>
            <code>{{ cmd_result.cmd }}</code>
            <br><br><strong>Output:</strong>
            <pre style="white-space: pre-wrap;">{{ cmd_result.output }}</pre>
        </div>
        {% endif %}

        <form action="{{ url_for('vuln_injection') }}" method="POST">
            <input type="hidden" name="action" value="cmd">
            <div class="form-group">
                <label for="hostname">Hostname / IP</label>
                <input type="text" id="hostname" name="hostname" placeholder="e.g., google.com">
            </div>
            <button type="submit" class="btn btn-danger">Ping Host</button>
        </form>
    </div>
</div>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-danger">Back to Dashboard</a>
</div>
{% endblock %}