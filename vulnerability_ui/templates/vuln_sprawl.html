{% extends 'base.html' %}

{% block content %}
<h1>08. API Sprawl (Zombie & Shadow APIs)</h1>
<p class="mb-4">Demonstrating risks of deprecated versions (Zombie APIs) and undocumented endpoints (Shadow APIs).</p>

<div class="grid">
    <!-- Zombie API -->
    <div class="card">
        <h3>1. Zombie API (v1 vs v2)</h3>
        <p>Try accessing the deprecated v1 endpoint which lacks authentication.</p>

        <div id="zombie-result" class="alert" style="display: none;"></div>

        <div style="display: flex; gap: 1rem;">
            <button onclick="fetchApi('/api/v2/users', 'zombie-result')" class="btn">Call v2 (Secure)</button>
            <button onclick="fetchApi('/api/v1/users', 'zombie-result')" class="btn btn-danger">Call v1
                (Insecure)</button>
        </div>
    </div>

    <!-- Shadow API -->
    <div class="card">
        <h3>2. Shadow API</h3>
        <p>Undocumented endpoints often escape security reviews.</p>
        <p class="text-muted">Hint: Developers sometimes leave <code>/test_debug_endpoint</code> active.</p>

        <div id="shadow-result" class="alert" style="display: none;"></div>

        <button onclick="fetchApi('/test_debug_endpoint', 'shadow-result')" class="btn btn-danger">Discover Shadow
            Endpoint</button>
    </div>
</div>

<script>
    async function fetchApi(url, resultId) {
        const resultDiv = document.getElementById(resultId);
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = 'Loading...';

        try {
            const res = await fetch(url);
            const data = await res.json();

            if (res.ok) {
                resultDiv.className = 'alert alert-success';
            } else {
                resultDiv.className = 'alert alert-error';
            }

            resultDiv.innerHTML = `<strong>${url}</strong><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
        } catch (e) {
            resultDiv.className = 'alert alert-error';
            resultDiv.innerHTML = e.message;
        }
    }
</script>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-danger">Back to Dashboard</a>
</div>
{% endblock %}