{% extends 'base.html' %}

{% block content %}
<h1>05. Rate Limiting</h1>
<p class="mb-4">Demonstrating lack of rate limiting and resource exhaustion.</p>

<div class="grid">
    <!-- Heavy Resource -->
    <div class="card">
        <h3>Heavy Resource Endpoint</h3>
        <p>This endpoint takes 2 seconds to respond. Try spamming it to exhaust server threads.</p>

        <div id="status-area" class="alert" style="display: none;"></div>

        <button id="spam-btn" class="btn btn-danger">Spam 5 Requests</button>
    </div>
</div>

<script>
    document.getElementById('spam-btn').addEventListener('click', async () => {
        const statusArea = document.getElementById('status-area');
        statusArea.style.display = 'block';
        statusArea.innerHTML = 'Starting spam attack...<br>';

        const promises = [];
        for (let i = 0; i < 5; i++) {
            statusArea.innerHTML += `Request ${i + 1} sent...<br>`;
            promises.push(
                fetch('{{ url_for("vuln_ratelimit_heavy") }}', { method: 'POST' })
                    .then(res => res.json())
                    .then(data => {
                        statusArea.innerHTML += `Request ${i + 1} completed.<br>`;
                    })
            );
        }

        await Promise.all(promises);
        statusArea.innerHTML += '<strong>All requests finished!</strong>';
    });
</script>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-danger">Back to Dashboard</a>
</div>
{% endblock %}