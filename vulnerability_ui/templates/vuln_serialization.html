{% extends 'base.html' %}

{% block content %}
<h1>04. Insecure Deserialization</h1>
<p class="mb-4">Demonstrating arbitrary code execution via unsafe deserialization (Pickle & YAML).</p>

<div class="grid">
    <!-- Pickle -->
    <div class="card">
        <h3>1. Pickle Deserialization</h3>
        <p>Unsafe unpickling of data. Requires Base64 encoded payload.</p>
        <p class="text-muted">Example (Python 3): <code>gASV...</code> (encodes an object)</p>

        {% if result and result.type == 'pickle' %}
        <div class="alert {% if result.status == 'error' %}alert-error{% else %}alert-success{% endif %}">
            {{ result.msg }}
        </div>
        {% endif %}

        <form action="{{ url_for('vuln_serialization') }}" method="POST">
            <input type="hidden" name="action" value="pickle">
            <div class="form-group">
                <label for="payload">Base64 Pickled Data</label>
                <textarea id="payload" name="payload" rows="3" placeholder="Enter base64 string..."></textarea>
            </div>
            <button type="submit" class="btn btn-danger">Deserialize (Pickle)</button>
        </form>
    </div>

    <!-- YAML -->
    <div class="card">
        <h3>2. YAML Deserialization</h3>
        <p>Unsafe YAML loading allowing Python object instantiation.</p>
        <p class="text-muted">Try: <code>!!python/object/apply:os.system ["echo 'pwned'"]</code></p>

        {% if result and result.type == 'yaml' %}
        <div class="alert {% if result.status == 'error' %}alert-error{% else %}alert-success{% endif %}">
            {{ result.msg }}
        </div>
        {% endif %}

        <form action="{{ url_for('vuln_serialization') }}" method="POST">
            <input type="hidden" name="action" value="yaml">
            <div class="form-group">
                <label for="yaml_payload">YAML Payload</label>
                <textarea id="yaml_payload" name="payload" rows="3" placeholder="Enter YAML..."></textarea>
            </div>
            <button type="submit" class="btn btn-danger">Deserialize (YAML)</button>
        </form>
    </div>
</div>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-danger">Back to Dashboard</a>
</div>
{% endblock %}